"use strict";define("singleAudioPlayer",["lodash","react","reactDOM","core","santaProps","audioCommon"],function(t,e,i,s,a,r){var o=s.compMixins,n=function(t){return 0===t?0:Math.ceil(t/20)},u=function(t){return 20*t},l=function(t){return t/1e3},h=function(t){return 1e3*t},c=function(t){var e=Math.floor(t/60),i=Math.floor(t%60);return(e<10?"0"+e:e)+":"+(i<10?"0"+i:i)},p=function(t,e,i){var s=(t.nativeEvent.offsetX?t.nativeEvent.offsetX:t.nativeEvent.layerX)/e;return Math.ceil(s*i)},d=function(t,e){"unmuted"===e?t.muteAudio():t.unmuteAudio()},g={displayName:"SingleAudioPlayer",mixins:[o.skinBasedComp,o.skinInfo,r.audioMixin],statics:{useSantaTypes:!0},propTypes:{compData:a.Types.Component.compData.isRequired,compProp:a.Types.Component.compProp.isRequired,styleId:a.Types.Component.styleId.isRequired},getInitialState:function(){return this.audioVolume=this.props.compProp.volume,this.autoPlay=this.props.compProp.autoplay,{$playerState:"waiting",$device:this.getDeviceState(),$isduration:"duration",$isMuted:"unmuted",trackDuration:0,progressPosition:0,volumeBars:n(this.props.compProp.volume),dragging:!1,$heightChanged:!1}},finishedPlayingAudio:function(){this.props.compProp.loop?this.playAudio():(this.initiatePause(),this.setState({$playerState:"repeat"}))},whileLoadingHandler:function(t){this.setState({trackDuration:l(t)})},whilePlayingHandler:function(t){this.setState({progressPosition:l(t)})},getProgressBarWidth:function(){return i.findDOMNode(this.refs.progressbar).offsetWidth},resetTrackPosition:function(){this.setState({progressPosition:0})},movingProgressbarHandle:function(t){var e=this.getProgressBarWidth(),i=this.getSkinExports("barSpaceLeft").barSpaceLeft,s=this.getSkinExports("barSpaceRight").barSpaceRight,a=this.props.style.width,r=t.pageX,o=this.getAudioDuration(),n=r<i||r>a-s,u=p(t,e,o);n||(this.setState({progressPosition:u/o*100}),this.seekAudio(u))},stoppedMovingProgressbarHandle:function(t){var e=this.getProgressBarWidth(),i=this.getAudioDuration(),s=p(t,e,i);this.setState({progressPosition:s/i*100}),this.seekAudio(s)},callSeek:function(t){var e=this.getProgressBarWidth(),i=this.getAudioDuration(),s=p(t,e,i);this.seekAudio(s)},buildVolumeScale:function(){var i=this.props.styleId,s=this.state.volumeBars;return t.times(5,function(t){return e.DOM.li({className:t<s?i+"_on":i+"_off",onClick:this.handleVolumeBarClick,"data-index":t+1},e.DOM.div({className:i+"_colorBlock"}),e.DOM.div({className:i+"_colorBlank"}))}.bind(this))},callToggleMute:function(){d(this,this.state.$isMuted),"unmuted"===this.state.$isMuted?this.setState({$isMuted:"muted"}):this.setState({$isMuted:"unmuted"})},getTargetIndex:function(t){return t.getAttribute("data-index")},setNonPersistentVolume:function(t){t=Math.min(t,5),t=Math.max(t,0),this.setState({volumeBars:t}),this.setVolume(u(t))},handleVolumeBarClick:function(t){var e=this.getTargetIndex(t.currentTarget);this.setNonPersistentVolume(e)},updateComponentHeight:function(t){return this.getSkinExports(t+"Height")[t+"Height"]},handleMediaButtonPress:function(){switch(this.state.$playerState){case"waiting":case"pausing":case"repeat":this.initiatePlay();break;case"playing":this.initiatePause()}},getMediaButtonAriaLabel:function(){switch(this.state.$playerState){case"waiting":case"pausing":return"Play";case"playing":return"Pause";case"repeat":return"Repeat"}},changeTrackPlayingPosition:function(t){var e=this.state.trackDuration;t=Math.min(t,e),t=Math.max(t,0),this.setState({progressPosition:t}),this.seekAudio(h(t))},handleAudioPlayerKeyDown:function(t){var e=.1*this.state.trackDuration;switch(t.key){case"ArrowLeft":this.changeTrackPlayingPosition(this.state.progressPosition-e),t.preventDefault();break;case"ArrowRight":this.changeTrackPlayingPosition(this.state.progressPosition+e),t.preventDefault();break;case"ArrowUp":this.setNonPersistentVolume(this.state.volumeBars+1),t.preventDefault();break;case"ArrowDown":this.setNonPersistentVolume(this.state.volumeBars-1),t.preventDefault()}},isMuteToggled:function(){return"unmuted"!==this.state.$isMuted},getVolumeLabel:function(){return u(this.state.volumeBars)+"% volume"+(this.isMuteToggled()?", muted":"")},getProgressPercentage:function(){return Math.floor(this.state.progressPosition/this.state.trackDuration*100)},getSkinProperties:function(){return this.autoPlay=this.props.compProp.autoplay,this.updateAudioObject(),{"":{style:{height:this.updateComponentHeight(this.getDeviceState())}},player:{role:"application","aria-label":"Application, Audio player, "+this.props.compData.track,onKeyDown:this.handleAudioPlayerKeyDown},sep:{children:" - "},sep2:{children:" / "},artistLabel:{children:this.props.compData.artist},trackLabel:{children:this.props.compData.track},mediaButton:{onClick:this.handleMediaButtonPress,"aria-label":this.getMediaButtonAriaLabel()},bar:{onClick:this.callSeek},slider:{onClick:this.callSeek,style:{width:this.getProgressPercentage()+"%"}},handle:{onDrag:this.movingProgressbarHandle,onDragEnd:this.stoppedMovingProgressbarHandle,style:{cursor:"pointer",left:this.getProgressPercentage()+"%"},draggable:!0},volumeBtn:{onClick:this.callToggleMute,"aria-label":"Mute","aria-pressed":this.isMuteToggled()},volumeControls:{onKeyPress:this.handleVolumeBtnKeyPress},volumeScale:{tabIndex:"0",children:this.buildVolumeScale(),role:"slider","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":20*this.state.volumeBars,"aria-valuetext":this.getVolumeLabel()},progressbar:{tabIndex:"0",role:"progressbar","aria-valuemin":"0","aria-valuemax":this.state.trackDuration,"aria-valuenow":this.state.progressPosition,"aria-valuetext":c(this.state.progressPosition)},trackDuration:{children:c(this.state.trackDuration)},trackPosition:{children:c(this.state.progressPosition)}}}};return s.compRegistrar.register("wysiwyg.common.components.singleaudioplayer.viewer.SingleAudioPlayer",g,!0),g});
//# sourceMappingURL=singleAudioPlayer.min.js.map